{% extends "baseSearch.html" %}

{% block search %}
<!-- Search bar -->
<div class="center">
    <div class="input-group">
        <input data-bind="value: actualQuery, valueUpdate: 'afterkeydown'"type="text" placeholder="Oprime Enter o el botón para buscar." class="form-control">
        <div class="input-group-btn">
            <button data-bind="html: delimiter" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Delimitar Búsqueda  <span class="caret"></span></button>
            <ul class="dropdown-menu pull-down">
                <li><a data-bind="click:$root.byAuthor" href="#">por autor</a></li>
                <li><a data-bind="click:$root.byTitle" href="#">por título</a></li>
                <li><a data-bind="click:$root.byCategory" href="#">por categoría</a></li>
                <li><a data-bind="click:$root.byDefault" href="#">general</a></li>
            </ul>
            <button data-bind="click:$root.getResults"  type="button" class="btn btn-info">Buscar</button>
        </div><!-- /btn-group -->
    </div><!-- /input-group -->
</div><!-- /.col-lg-6 -->
<!-- End search bar -->
{% endblock %}

{% block results %}
    <h4 data-bind="text: googleResultsDescription" class="">Se encontraron 8 resultados en nuestra base de datos.</h4>
    <div data-bind="visible: googleResults().length > 1">
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <th class="">Título</th>
                    <th class="">Autor</th>
                    <th class="">Editorial</th>
                    <th class="">Expositor</th>
                    <th class="">Stand</th>
                </tr>
                <tr>
                    <td class="">cell</td>
                    <td class="">cell</td>
                    <td class="">cell</td>
                    <td class="">cell</td>
                    <td class="">cell</td>
                </tr>
            </tbody>
        </table>
        <div class="btn-group">
            <button class="btn" contenteditable="false">1</button>
            <button class="btn" contenteditable="false">2</button>
            <button class="btn" contenteditable="false">3</button>
        </div> <!-- button group -->
        <h4 class="">Se encontraron 431 resultados en la base de datos de Google.</h4>

        <table class="table table-bordered">
            <tbody>
                <tr>
                    <th class="">Título</th>
                    <th class="">Autor</th>
                    <th class="">Editorial</th>
                    <th class="">Posible Expositor</th>
                    <th class="">Stand</th>
                </tr>
                <tr>
                    <td class="">cell</td>
                    <td class="">cell</td>
                    <td class="">cell</td>
                    <td class="">cell</td>
                    <td class="">cell</td>
                </tr>
            </tbody>
        </table>
        <div class="btn-group">
            <button class="btn" contenteditable="false">1</button>
            <button class="btn" contenteditable="false">2</button>
            <button class="btn" contenteditable="false">3</button>
        </div> <!-- button group -->
    </div>

    <!-- json display -->
    <div>
        <h2>DEBUG</h2>
        <h4>View Model</h4>
        <div>
           <p><span data-bind="html: delimiter"></span></p>
           <p><span data-bind="text: actualQuery"></span></p>
           <p><span data-bind="text: ourResultsDescription"></span></p>
           <p><span data-bind="text: googleResultsDescription"></span></p>
           <table class="table table-bordered">
                <tbody data-bind="foreach: ourResults">
                    <tr>
                        <th>Título</th>
                        <th>Autor</th>
                        <th>Editorial</th>
                        <th>Expositor</th>
                        <th>Stand</th>
                    </tr>
                    <tr>
                        <td data-bind="text: title">Título</td>
                        <td data-bind="text: author">Author</td>
                        <td data-bind="text: editorial">Editorial</td>
                        <td data-bind="text: exhibitor">Exhibitor</td>
                        <td data-bind="text: stand">Stand</td>
                    </tr>
                </tbody>
           </table>
           <table class="table table-bordered">
                <tbody data-bind="foreach: googleResults">
                    <tr>
                        <th>Título</th>
                        <th>Autor</th>
                        <th>Editorial</th>
                        <th>Posible Expositor</th>
                        <th>Stand</th>
                    </tr>
                    <tr>
                        <td data-bind="text: title">Title</td>
                        <td data-bind="text: author">Author</td>
                        <td data-bind="text: editorial">Editorial</td>
                        <td data-bind="text: exhibitor">Exhibitor</td>
                        <td data-bind="text: stand">Stand</td>
                    </tr>
                </tbody>
           </table>
        </div>

        <h4>
            JSON Data
            <p data-bind="text:jsonData"></p>
        </h4>
    </div>
    <!-- end json display -->
{% endblock %}

{% block js %}
    function Result(title, author, editorial, exhibitor, stand){
        var self = this;
        self.title = title;
        self.author = author;
        self.editorial = editorial;
        self.exhibitor = exhibitor;
        self.stand = stand;
    }
    function searchViewModel() {
        var self = this;

        self.delimiter = ko.observable("Delimitar Búsqueda  <span class='caret'></span>");
        self.actualQuery = ko.observable('');
        self.googleResultsDescription = ko.observable("Realice su búsqueda.");
        self.ourResultsDescription = ko.observable("Realice su búsqueda.");

        self.googleResults = ko.observableArray([
            {
                title: 'Loving DBs!',
                author: 'Lorena Gómez',
                editorial: 'Alfaguara',
                exhibitor: 'Planeta',
                stand: 'F'
            }
        ]);

        self.ourResults = ko.observableArray([
            {
                title: 'Loving DBs!',
                author: 'Lorena Gómez',
                editorial: 'Alfaguara',
                exhibitor: 'Planeta',
                stand: 'F'
            }
        ]);

        self.jsonData = ko.observable();

        // Behaviors
        self.byTitle = function() {
            self.delimiter("por título  <span class='caret'></span>");
        };
        self.byAuthor = function() {
            self.delimiter("por autor  <span class='caret'></span>");
        };
        self.byCategory = function() {
            self.delimiter("por categoría  <span class='caret'></span>");
        };
        self.byDefault = function() {
            self.delimiter("Delimitar Búsqueda  <span class='caret'></span>");
        };

        self.getResults = function() {
            q = self.actualQuery;
            $.get('../expositores/libros/busqueda/', { query: q }, self.jsonData);
            // use observableArray.push(object) in order to push data to results
            // cycle the jsonData and create results
            // update observableArrays...
            var json = jQuery.parseJSON(self.jsonData);
            var our = [];
            var google = [];
            var jsonOur = json['dbResults'];
            var jsonGoogle = json['googleResults']; console.log(typeof(jsonGoogle));
            //for (var x = 0; x < results.length; x++) {
             //   console.log ( new Result(jsonGoogle['results'][x]['title'], 'uno', 'dos', 'tres', 'cuatro') )
           // }
        };

    }
    var vm = new searchViewModel();
    ko.applyBindings(vm);
{% endblock %}

{% block jQuery %}

{% endblock %}
